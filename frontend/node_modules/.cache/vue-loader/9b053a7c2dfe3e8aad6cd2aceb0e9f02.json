{"remainingRequest":"/Users/philippwegner/Desktop/Fraunhofer/SEM-Group/git/data-steward-tool/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/philippwegner/Desktop/Fraunhofer/SEM-Group/git/data-steward-tool/src/components/DataUpload.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Users/philippwegner/Desktop/Fraunhofer/SEM-Group/git/data-steward-tool/src/components/DataUpload.vue","mtime":1632903542504},{"path":"/Users/philippwegner/Desktop/Fraunhofer/SEM-Group/git/data-steward-tool/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/philippwegner/Desktop/Fraunhofer/SEM-Group/git/data-steward-tool/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/philippwegner/Desktop/Fraunhofer/SEM-Group/git/data-steward-tool/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/philippwegner/Desktop/Fraunhofer/SEM-Group/git/data-steward-tool/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouZmxvYXRfYm90dG9tX3JpZ2h0IHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgYm90dG9tOiAzMHB4OwogIHJpZ2h0OiAzMHB4Owp9CgoudGFwLXRhcmdldCB7CiAgY29sb3I6ICNmZmY7Cn0KLnRhcC10YXJnZXQgYSB7CiAgY29sb3I6ICNmZmY7CiAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7Cn0K"},{"version":3,"sources":["DataUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwSA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DataUpload.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <h1>Data Upload</h1>\n    <div class=\"container center-align\">\n      <div class=\"row\">\n        \n        <div class=\"input-field col s6\">\n        <p>Please select a source for your data!</p>\n      <select class=\"browser-default\" id=\"sourceSelect\">\n        <option v-for=\"src in sourceList\" :key=\"src\" :value=\"src\">{{src}}</option>\n      </select>\n      </div>\n      </div>\n      <vue-dropzone\n        ref=\"myVueDropzone\"\n        id=\"dropzone\"\n        :options=\"dropzoneOptions\"\n        @vdropzone-success=\"vsuccess\"\n        @vdropzone-error=\"verror\"\n        @vdropzone-file-added=\"addedFile\"\n        @vdropzone-sending=\"sendingEvent\"\n      ></vue-dropzone>\n      <vue-ellipse-progress\n        id=\"loader\"\n        class=\"hide\"\n        :progress=\"progress\"\n        v-bind=\"options\"\n      >\n        <!--\n        <span slot=\"legend-value\" style=\"color : black\" id=\"totalCount\"></span>-->\n        <p slot=\"legend-caption\" id=\"feedback\"></p>\n      </vue-ellipse-progress>\n\n      <p id=\"totalCount\"></p>\n      \n      <p id=\"post_process_feedback\"></p>\n      <p id=\"totalOLS\"></p>\n      <div\n        id=\"not_found\"\n        v-if=\"notFound.length > 0\"\n        class=\"container\"\n        style=\"margin-bottom: 80px\"\n      >\n        <h5>Variables not automatically mapped (total: {{ this.notFound.length }}):</h5>\n       \n            <ul v-for=\"attr in notFound\" :key=\"attr\">\n              <li>{{ attr }}</li>\n\n             \n            </ul>\n\n        <a href=\"/data-steward/mapper\">Go to mapping assistant</a>\n     \n        <!--\n        <div class=\"row mt-3\">\n          <div class=\"col s1\">\n        <button class=\"btn blue-grey lighten-1\" @click=\"refreshAttributes()\">refresh targets</button>\n          </div>\n          <div class=\"col s11\"></div>\n        </div>-->\n      </div>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport vue2Dropzone from \"vue2-dropzone\";\nimport \"vue2-dropzone/dist/vue2Dropzone.min.css\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport M from \"materialize-css\";\nimport $ from \"jquery\";\nimport axios from \"axios\";\n\nexport default {\n  components: {\n    vueDropzone: vue2Dropzone,\n  },\n  data: function () {\n    return {\n      dropzoneOptions: {\n        url: process.env.VUE_APP_CLINICALURL + \"/post/basic-upload\",\n        thumbnailWidth: 150,\n        addRemoveLinks: true,\n        maxFiles: 1,\n      },\n      notFound: [],\n      allAttributes: {},\n      allSources: {},\n      sourceList: [],\n      id: uuidv4(),\n      updateUrl: process.env.VUE_APP_CLINICALURL + \"/get/cache\",\n      interval: 2000,\n      progress: 0,\n      options: {\n        color: \"#579fdc\",\n        \"empty-color\": \"#324c7e\",\n        size: 300,\n        thickness: 5,\n        \"empty-thickness\": 3,\n        \"line-mode\": \"out 5\",\n        animation: \"rs 700 1000\",\n        \"font-size\": \"1.5rem\",\n        \"font-color\": \"white\",\n      },\n    };\n  },\n  async created() {\n    const attributes = await axios.get(\n      process.env.VUE_APP_CLINICALURL + \"/get/attributes/all\"\n    );\n    const sources_all = await axios.get(\n      process.env.VUE_APP_CLINICALURL + \"/get/sources/all\"\n    );\n    var sourceObj = {};\n    var sourceList = [];\n    sources_all[\"data\"][\"sources\"].forEach((elem) => {\n      sourceObj[elem] = null;\n      sourceList.push(elem);\n    });\n    this.allSources = sourceObj;\n    this.sourceList = sourceList;\n    var attrObj = {};\n    attributes[\"data\"][\"attributes\"].forEach((attr) => {\n      attrObj[attr.name] = null;\n    });\n    this.allAttributes = attrObj;\n  },\n\n  mounted(){\n    var elems = document.querySelectorAll('select');\n    M.FormSelect.init(elems);\n  },\n  updated() {\n    var elems = document.querySelectorAll(\".autocomplete\");\n\n    M.Autocomplete.init(elems, { data: this.allAttributes });\n    var elems_source = document.querySelectorAll(\".autocomplete_source\");\n\n    M.Autocomplete.init(elems_source, {\n      data: this.allSources,\n      onAutocomplete: function (val) {\n        var emptyFields = [];\n        document.querySelectorAll(\".autocomplete_source\").forEach((elem) => {\n          if (elem.value == null || elem.value == \"\") {\n            emptyFields.push(elem);\n          }\n        });\n\n        emptyFields.forEach((elem) => {\n          elem.value = val;\n        });\n        M.updateTextFields();\n      },\n    });\n  },\n\n  methods: {\n\n\n    refreshAttributes: async function(){\n          const attributes = await axios.get(\n      process.env.VUE_APP_CLINICALURL + \"/get/attributes/all\"\n    );\n    const sources_all = await axios.get(\n      process.env.VUE_APP_CLINICALURL + \"/get/sources/all\"\n    );\n    var sourceObj = {};\n    sources_all[\"data\"][\"sources\"].forEach((elem) => {\n      sourceObj[elem] = null;\n    });\n    this.allSources = sourceObj;\n\n    var attrObj = {};\n    attributes[\"data\"][\"attributes\"].forEach((attr) => {\n      attrObj[attr.name] = null;\n    });\n    this.allAttributes = attrObj;\n    M.toast({html: \"Refreshed variable autocomplete...\"});\n\n    },\n    addMapping: async function (attr) {\n      var target = document.getElementById(attr + \"_mapping_field\").value;\n      if (target == null || target == \"\") {\n        M.toast({ html: \"Please check your input!\" });\n        return;\n      }\n\n      var source = document.getElementById(attr + \"_source_field\").value;\n\n      const mappingResponse = await axios({\n        method: \"post\",\n        url: process.env.VUE_APP_CLINICALURL + \"/post/basic-mapping\",\n        data: {\n          source: source,\n          source_attribute: attr,\n          target: target,\n        },\n        withCredentials: true,\n      });\n      if (mappingResponse.data[\"message\"] == \"ok\") {\n        this.notFound = this.notFound.filter((item) => item != attr);\n        M.toast({ html: \"You successfully mapped: \" + attr });\n      } else {\n        document.getElementById(attr + \"_feedback\").innerText =\n          mappingResponse.data[\"message\"];\n      }\n      return;\n    },\n    addedFile: function () {\n      document.getElementById(\"feedback\").innerText =\n        \"Your data is getting processed\";\n    },\n    setProgress: function (prog) {\n      this.progress = prog;\n      return;\n    },\n\n    check_status: function () {\n      var self = this;\n      $.ajax({\n        type: \"GET\",\n        url: self.updateUrl,\n        data: { _id: self.id },\n        success: function (e) {\n          console.log(e);\n          if (e.message != null && e[\"message\"][\"status\"] == \"done\") {\n            console.log(\"Done\");\n          }\n        },\n        complete: function (e) {\n          if(e.responseJSON['message'] == null){\n            setTimeout(self.check_status, self.interval);\n          }\n          var notFoundList = e.responseJSON[\"message\"][\"not_found\"];\n\n          if (e.responseJSON[\"message\"][\"status\"] == \"done\") {\n            self.progress = 100;\n            //$(\"#loader\").addClass(\"hide\");\n            $(\"#totalCount\").hide();\n\n            self.notFound = notFoundList;\n            document.getElementById(\"feedback\").innerText =\n              e.responseJSON[\"message\"][\"message\"];\n\n            document.getElementById(\"post_process_feedback\").innerText =\n              e.responseJSON[\"message\"][\"message\"];\n            //document.getElementById('totalOLS').innerText = \"Imported from OLS: \"  + e.responseJSON['message']['ols_count'];\n            $(\"#loader\").hide();\n            return;\n\n            /**\n             *\n             * Add not found feed back\n             */\n          } else {\n            self.notFound = notFoundList;\n            document.getElementById(\"totalCount\").innerText =\n              \"Processing \" +\n              e.responseJSON[\"message\"][\"total\"] +\n              \" lines of data...\";\n            self.progress = e.responseJSON[\"message\"][\"done\"];\n            setTimeout(self.check_status, self.interval);\n          }\n        },\n      });\n    },\n    vsuccess: function (file, response) {\n      var text = \"Successfully uploaded file \" + file.name;\n      M.toast({ html: text });\n\n      document.getElementById(\"feedback\").innerText = response[\"message\"];\n      document.getElementById(\"dropzone\").classList.add(\"hide\");\n      document.getElementById(\"loader\").classList.remove(\"hide\");\n\n      //var self = this;\n\n      this.check_status();\n    },\n    verror: function (file) {\n      var text = \"Error while uploading \" + file.name;\n      M.toast({ html: text });\n      document.getElementById(\"loader\").classList.add(\"hide\");\n      document.getElementById(\"feedback\").innerText =\n        \"Something went wrong... Please try again later\";\n    },\n\n    sendingEvent(file, xhr, formData) {\n      formData.append(\"_id\", this.id);\n      formData.append(\"_source\", document.getElementById('sourceSelect').value);\n    },\n  },\n};\n</script>\n\n<style>\n.float_bottom_right {\n  position: absolute;\n  bottom: 30px;\n  right: 30px;\n}\n\n.tap-target {\n  color: #fff;\n}\n.tap-target a {\n  color: #fff;\n  text-decoration: underline;\n}\n</style>"]}]}